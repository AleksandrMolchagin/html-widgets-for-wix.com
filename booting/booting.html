<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content ="width=device-width", initial-scale = "1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>typing-code</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@300&display=swap');
            * {
            margin: 0;
            padding: 0;
            }
            body {
            font-family: 'Source Code Pro', monospace;
            background-color: #000000;
            color: #eeeeee;
            padding-top: 2%;
            }
            .container {
            text-align: left;
            }
            .container p {
            margin-left: 20%;
            margin-right: 20%;
            font-size: 1.25rem;
            font-weight: bold;
            }
            .end-button {
            font-family: 'Source Code Pro', monospace;
            font-size: 1.25rem;
            font-weight: bold;
            color: red;
            margin-top: 2.5%;
            margin-left: 23%;
            margin-right: 23%;
            background-color: transparent;
            border: 0px;
            animation: blink-button 2s infinite;
            }
            .typed-text {
            font-weight: bold;
            color: red;

            }
            .typed-color-text{
            text-align: center;
            font-weight: bold;
            color: white;
            background-color:darkred;
            }
            .cursor {
                display: inline-block;
                width: 14.5px;
                background-color: #ccc;
                margin-left: 00.2rem;
                animation: blink 1s infinite;
            }
            .cursor.typing{
            animation: none;
            }
            .cursor.non-visible{
            visibility: hidden;
            }
            @keyframes blink {
                0% {background-color: #ccc;}
                50% {background-color: transparent;}
                100% {background-color: #ccc;}
            }
            @keyframes blink-button{
            0% {color: darkred;}
            50% {color: red;}
            100% {color: darkred;}
            }
        </style>
    </head>
    <body>
        <div class = "container">
            <p><span id="text"></span> -> <span class="typed-text"></span><span class="cursor">&nbsp;</span></p>
        </div>
        <button class="end-button" type="button", id="end" style="float: right; visibility: hidden;" onclick="window.open('https://www.aleksandrmolchagin.com/');">CLICK HERE TO CONTINUE</button>
        <script>
            const mainText = document.getElementById("text");
            const typedTextSpan = document.querySelector(".typed-text");
            const cursorSpan = document.querySelector(".cursor");
            //const textArray = ["IS STARTING"];
            const typingDelay = 50;
            //const erasingDelay = 50;
            const newParDelay = 2500;
            //let textArrayIndex = 0;
            let lineOfArrayNum = 0;
            let charIndex = 0;
            let lineInd = 0;
            let arrayNum = 0;
            //arrays for paragraphs
            const parArrayText = ["ALEKSANDRMOLCHAGIN.COM", "PERSONAL WEBSITE","//"];
            const parArrayText2 = ["CONNECTION HAS BEEN ESTABLISHED"];
            const parArrayText3 = ["GETTING PERMISSION TO ACCESS THE WEBSITE"];
            const parArrayText4 = ["YOUR PERMISSION IS GRANTED", "THE CODE IS ACTIVATED", "//"];
            const parArrayText5 = ["54 68 65 72 65 20 69 73 20 6E 6F 20 65 6D 6F 74 69 6F 6E 2C 20 74 68 65 72 65 20 69 73 20 70 65 61 63 65 2E 0D 0A 54 68 65 72 65 20 69 73 20 6E 6F 20 69 67 6E 6F 72 61 6E 63 65 2C 20 74 68 65 72 65 20 69 73 20 6B 6E 6F 77 6C 65 64 67 65 2E 0D 0A 54 68 65 72 65 20 69 73 20 6E 6F 20 70 61 73 73 69 6F 6E 2C 20 74 68 65 72 65 20 69 73 20 73 65 72 65 6E 69 74 79 2E 0D 0A 54 68 65 72 65 20 69 73 20 6E 6F 20 63 68 61 6F 73 2C 20 74 68 65 72 65 20 69 73 20 68 61 72 6D 6F 6E 79 2E 0D 0A 54 68 65 72 65 20 69 73 20 6E 6F 20 64 65 61 74 68 2C 20 74 68 65 72 65 20 69 73 20 74 68 65 20 46 6F 72 63 65 2E"];
            
            //the list of all paragraphs, for each paragraph use an array, not a string
            let arrayOfArrays = [parArrayText, parArrayText2, parArrayText3, parArrayText4, parArrayText5]
          
            
            let parArray = [];
            //puting elements
            parArrayText.forEach(putArray);
            //creating an array of paragraphs
            function putArray(item, index, arr){
                var para = document.createElement("p");
                if (item == "CONNECTION HAS BEEN ESTABLISHED")
                    para.setAttribute("class", "typed-color-text");
                else
                    para.setAttribute("class", "typed-text");
                var node = document.createTextNode("");
                para.appendChild(node);
                var element = document.querySelector("div");
                element.appendChild(para);
                parArray.push(para)
            }
            //add an empty line
            function addGap(){
                document.querySelector("div").appendChild(document.createElement("br"));
            }
            function typePar() {
                if(charIndex < arrayOfArrays[arrayNum][lineOfArrayNum].length)
                {
                    if(!cursorSpan.classList.contains("non-visible")) cursorSpan.classList.add("non-visible");
                    parArray[lineInd].textContent += arrayOfArrays[arrayNum][lineOfArrayNum].charAt(charIndex);
                    charIndex++;
                    setTimeout(typePar, typingDelay);
                }
                else if (lineOfArrayNum < arrayOfArrays[arrayNum].length-1)
                {
                    if (parArray[lineInd].textContent.length == arrayOfArrays[arrayNum][lineOfArrayNum].length) 
                    {
                        if(cursorSpan.classList.contains("non-visible")) cursorSpan.classList.remove("non-visible");
                        charIndex = 0;
                        lineInd++;
                        lineOfArrayNum++;
                        setTimeout(typePar, typingDelay)
                    }
                }
                else if (arrayNum < arrayOfArrays.length-1)
                {
                    if(cursorSpan.classList.contains("non-visible")) cursorSpan.classList.remove("non-visible")
                    parArray[lineInd].appendChild(cursorSpan);
                    addGap()
                    lineInd++;
                    arrayNum++;
                    arrayOfArrays[arrayNum].forEach(putArray);
                    charIndex = 0;
                    lineOfArrayNum = 0;
                    addGap();
                    setTimeout(typePar, newParDelay)
                }
                else //nothing to type -> make button visible
                {
                    document.getElementById("end").setAttribute("style", "float: right; visibility: visible")
                }
            }
            document.addEventListener("DOMContentLoaded", function() {
                //getting IP adress using www.cloudflare.com
                fetch('https://www.cloudflare.com/cdn-cgi/trace').then(res => res.text()).then(data => {
                let ipRegex = /[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}/
                let ip = data.match(ipRegex)[0];
                mainText.textContent = ip;
                });
                //typing all paragraphs
                setTimeout(typePar, newParDelay)
            })
        </script>
    </body>
</html>
